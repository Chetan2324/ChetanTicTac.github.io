<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tic-Tac-Toe</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
        }
        .cell {
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .cell:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
        }
        .x::before, .x::after {
            content: '';
            position: absolute;
            width: 80%;
            height: 12px;
            background-color: #f472b6;
            border-radius: 9999px;
            top: 50%;
            left: 50%;
            transform-origin: center;
            animation: draw-x 0.5s ease-out forwards;
        }
        .x::before {
            transform: translate(-50%, -50%) rotate(45deg);
        }
        .x::after {
            transform: translate(-50%, -50%) rotate(-45deg);
        }
        .o::before {
            content: '';
            position: absolute;
            width: 70%;
            height: 70%;
            border: 12px solid #60a5fa;
            border-radius: 50%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            animation: draw-o 0.5s ease-out forwards;
        }

        @keyframes draw-x {
            from { width: 0; }
            to { width: 80%; }
        }

        @keyframes draw-o {
            from { transform: translate(-50%, -50%) scale(0); }
            to { transform: translate(-50%, -50%) scale(1); }
        }

        .win-line {
            position: absolute;
            background-color: #fbbf24;
            height: 8px;
            border-radius: 4px;
            transform-origin: left;
            animation: strike 0.5s ease-out forwards;
            box-shadow: 0 0 20px #fbbf24;
        }

        @keyframes strike {
            from { width: 0; }
            to { width: 100%; }
        }
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen flex items-center justify-center p-4">
    <main class="w-full max-w-md mx-auto bg-gray-800 rounded-2xl shadow-2xl p-6 md:p-8">
        <h1 class="text-4xl md:text-5xl font-bold text-center mb-2 bg-clip-text text-transparent bg-gradient-to-r from-pink-400 to-blue-500">Tic-Tac-Toe</h1>
        <div id="status" class="text-xl text-center mb-6 h-8 transition-all duration-300">Select a mode to start</div>

        <!-- Game Mode Selection -->
        <div id="mode-selection" class="flex justify-center space-x-4 mb-6">
            <button id="pvc-btn" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg transition-transform transform hover:scale-105">Player vs Computer</button>
            <button id="pvp-btn" class="bg-pink-500 hover:bg-pink-600 text-white font-bold py-2 px-4 rounded-lg transition-transform transform hover:scale-105">Player vs Player</button>
        </div>

        <!-- Game Board -->
        <div class="relative">
            <div id="board" class="grid grid-cols-3 gap-3 md:gap-4 aspect-square pointer-events-none opacity-50">
                <!-- Cells will be generated by JS -->
            </div>
            <div id="win-line-container"></div>
        </div>

        <!-- Restart Button -->
        <div class="text-center mt-6">
            <button id="restart-btn" class="bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-8 rounded-lg transition-transform transform hover:scale-105 opacity-0 invisible transition-all duration-500">Restart Game</button>
        </div>

         <!-- Message Modal -->
         <div id="message-modal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center hidden">
            <div class="bg-gray-800 rounded-lg p-8 text-center shadow-xl">
                <p id="message-text" class="text-2xl mb-6"></p>
                <button id="close-modal-btn" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-6 rounded-lg">OK</button>
            </div>
        </div>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const board = document.getElementById('board');
            const statusDisplay = document.getElementById('status');
            const restartBtn = document.getElementById('restart-btn');
            const pvcBtn = document.getElementById('pvc-btn');
            const pvpBtn = document.getElementById('pvp-btn');
            const modeSelection = document.getElementById('mode-selection');
            const winLineContainer = document.getElementById('win-line-container');
            const messageModal = document.getElementById('message-modal');
            const messageText = document.getElementById('message-text');
            const closeModalBtn = document.getElementById('close-modal-btn');

            let currentPlayer = 'X';
            let gameActive = false;
            let gameState = ["", "", "", "", "", "", "", "", ""];
            let gameMode = null; // 'pvc' or 'pvp'

            const winningConditions = [
                [0, 1, 2], [3, 4, 5], [6, 7, 8], // Rows
                [0, 3, 6], [1, 4, 7], [2, 5, 8], // Columns
                [0, 4, 8], [2, 4, 6]  // Diagonals
            ];

            function showMessage(message) {
                messageText.textContent = message;
                messageModal.classList.remove('hidden');
            }

            closeModalBtn.addEventListener('click', () => {
                messageModal.classList.add('hidden');
            });

            function handleResultValidation() {
                let roundWon = false;
                let winningCombination = [];
                for (let i = 0; i < winningConditions.length; i++) {
                    const winCondition = winningConditions[i];
                    const a = gameState[winCondition[0]];
                    const b = gameState[winCondition[1]];
                    const c = gameState[winCondition[2]];
                    if (a === '' || b === '' || c === '') {
                        continue;
                    }
                    if (a === b && b === c) {
                        roundWon = true;
                        winningCombination = winCondition;
                        break;
                    }
                }

                if (roundWon) {
                    statusDisplay.textContent = `Player ${currentPlayer} has won!`;
                    drawWinningLine(winningCombination);
                    gameActive = false;
                    showRestartButton();
                    return;
                }

                if (!gameState.includes("")) {
                    statusDisplay.textContent = `Game ended in a draw!`;
                    gameActive = false;
                    showRestartButton();
                    return;
                }

                handlePlayerChange();
            }
            
            function drawWinningLine(combination) {
                const startCell = document.querySelector(`[data-cell-index='${combination[0]}']`);
                const endCell = document.querySelector(`[data-cell-index='${combination[2]}']`);
                
                const boardRect = board.getBoundingClientRect();
                const startRect = startCell.getBoundingClientRect();
                const endRect = endCell.getBoundingClientRect();

                const line = document.createElement('div');
                line.classList.add('win-line');
                
                const startX = startRect.left + startRect.width / 2 - boardRect.left;
                const startY = startRect.top + startRect.height / 2 - boardRect.top;
                const endX = endRect.left + endRect.width / 2 - boardRect.left;
                const endY = endRect.top + endRect.height / 2 - boardRect.top;

                const angle = Math.atan2(endY - startY, endX - startX) * 180 / Math.PI;
                const length = Math.sqrt(Math.pow(endX - startX, 2) + Math.pow(endY - startY, 2));

                line.style.width = `${length}px`;
                line.style.top = `${startY}px`;
                line.style.left = `${startX}px`;
                line.style.transform = `rotate(${angle}deg)`;
                
                winLineContainer.appendChild(line);
            }


            function handlePlayerChange() {
                currentPlayer = currentPlayer === 'X' ? 'O' : 'X';
                statusDisplay.textContent = `It's ${currentPlayer}'s turn`;

                if(gameMode === 'pvc' && currentPlayer === 'O' && gameActive) {
                    board.classList.add('pointer-events-none');
                    setTimeout(computerMove, 700);
                }
            }

            function computerMove() {
                let availableCells = [];
                gameState.forEach((cell, index) => {
                    if (cell === "") {
                        availableCells.push(index);
                    }
                });

                if (availableCells.length > 0) {
                    const move = availableCells[Math.floor(Math.random() * availableCells.length)];
                    handleCellClick({ target: document.querySelector(`[data-cell-index='${move}']`) });
                }
                board.classList.remove('pointer-events-none');
            }

            function handleCellClick(clickedCellEvent) {
                const clickedCell = clickedCellEvent.target;
                const clickedCellIndex = parseInt(clickedCell.getAttribute('data-cell-index'));

                if (gameState[clickedCellIndex] !== "" || !gameActive) {
                    return;
                }

                handleCellPlayed(clickedCell, clickedCellIndex);
                handleResultValidation();
            }

            function handleCellPlayed(clickedCell, clickedCellIndex) {
                gameState[clickedCellIndex] = currentPlayer;
                clickedCell.classList.add(currentPlayer.toLowerCase());
            }

            function showRestartButton() {
                restartBtn.classList.remove('opacity-0', 'invisible');
                restartBtn.classList.add('opacity-100', 'visible');
            }

            function handleRestartGame() {
                gameActive = true;
                currentPlayer = 'X';
                gameState = ["", "", "", "", "", "", "", "", ""];
                statusDisplay.textContent = `It's ${currentPlayer}'s turn`;
                document.querySelectorAll('.cell').forEach(cell => {
                    cell.classList.remove('x', 'o');
                });
                winLineContainer.innerHTML = '';
                restartBtn.classList.remove('opacity-100', 'visible');
                restartBtn.classList.add('opacity-0', 'invisible');
                if (gameMode === 'pvc' && currentPlayer === 'O') {
                     board.classList.add('pointer-events-none');
                    setTimeout(computerMove, 700);
                } else {
                    board.classList.remove('pointer-events-none');
                }
            }

            function startGame(mode) {
                gameMode = mode;
                gameActive = true;
                board.innerHTML = '';
                winLineContainer.innerHTML = '';
                for (let i = 0; i < 9; i++) {
                    const cell = document.createElement('div');
                    cell.classList.add('cell', 'bg-gray-700', 'rounded-lg', 'flex', 'items-center', 'justify-center', 'text-5xl', 'md:text-7xl', 'font-bold', 'cursor-pointer', 'relative', 'aspect-square');
                    cell.setAttribute('data-cell-index', i);
                    cell.addEventListener('click', handleCellClick);
                    board.appendChild(cell);
                }
                board.classList.remove('pointer-events-none', 'opacity-50');
                modeSelection.classList.add('hidden');
                statusDisplay.textContent = `It's X's turn`;
                handleRestartGame();
            }

            pvcBtn.addEventListener('click', () => startGame('pvc'));
            pvpBtn.addEventListener('click', () => startGame('pvp'));
            restartBtn.addEventListener('click', handleRestartGame);
        });
    </script>
</body>
</html>